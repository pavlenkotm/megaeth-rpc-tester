name: Multi-Language CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  # Python RPC Tester
  python:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Lint with flake8
        run: |
          pip install flake8
          flake8 rpc_tester --count --select=E9,F63,F7,F82 --show-source --statistics
      - name: Run tests
        run: |
          pip install pytest pytest-asyncio
          pytest tests/ -v

  # TypeScript/JavaScript
  typescript:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/typescript
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Lint
        run: npm run lint --if-present
      - name: Build
        run: npm run build --if-present

  # Solidity
  solidity:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/solidity
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Compile contracts
        run: npx hardhat compile

  # Go
  go:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/go
    steps:
      - uses: actions/checkout@v3
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      - name: Download dependencies
        run: go mod download
      - name: Build
        run: go build -v ./...
      - name: Test
        run: go test -v ./...

  # Rust
  rust:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/rust
    steps:
      - uses: actions/checkout@v3
      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true
      - name: Check format
        run: cargo fmt -- --check
      - name: Build
        run: cargo build --verbose
      - name: Run tests
        run: cargo test --verbose

  # Java
  java:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/java
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'
      - name: Build with Maven
        run: mvn clean compile

  # Ruby
  ruby:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/ruby
    steps:
      - uses: actions/checkout@v3
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
      - name: Check syntax
        run: ruby -c web3_client.rb

  # C++
  cpp:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/cpp
    steps:
      - uses: actions/checkout@v3
      - name: Install dependencies
        run: sudo apt-get update && sudo apt-get install -y cmake libssl-dev
      - name: Build
        run: |
          mkdir -p build
          cd build
          cmake ..
          make

  # Zig
  zig:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/zig
    steps:
      - uses: actions/checkout@v3
      - name: Setup Zig
        uses: goto-bus-stop/setup-zig@v2
        with:
          version: '0.11.0'
      - name: Build
        run: zig build

  # Bash scripts
  bash:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/bash
    steps:
      - uses: actions/checkout@v3
      - name: Lint bash scripts
        run: |
          sudo apt-get install shellcheck
          shellcheck *.sh

  # HTML/CSS/JS validation
  web:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: languages/html-css
    steps:
      - uses: actions/checkout@v3
      - name: Validate HTML
        run: |
          npm install -g html-validate
          html-validate index.html || true
